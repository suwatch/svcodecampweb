@*The View Model is Referenced from _Layout.cshtml.  Only items relevant to the page displayed are populated in model*@

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    $(document).ready(function () {

        var floatingElement,
            targetSelectBtn,
            timeoutVal;

        function getAllSessionTime() {
            console.log($('.sessionsList .sessionDetails').length);
            console.log($('tr.session').length);
        }

        getAllSessionTime();

        function monitorFloatingElement(el) {
            floatingElement = el;
        }

        function hideFloatingElement(el) {
            $(el).hide();
            if (timeoutVal) {
                clearTimeout(timeoutVal);
            }
        }

        $('body').click(function () {
            hideFloatingElement(floatingElement);
        });

        // Session details floating panel
        $('.detailsBtn').click(function (e) {
            var buttonOffset = $(this).offset(),
            sessionId = $(this).attr('sessionId');
            console.log(sessionId);
            if (floatingElement) {
                hideFloatingElement(floatingElement);
            }
            monitorFloatingElement('#detailsFloatingPanel');
            $('#detailsFloatingPanel').fadeIn('fast', 'linear').css({
                'top': buttonOffset.top - 408
            });

            // Copy session description
            $('#detailsFloatingPanel .description').html($('#sessionDescription_' + sessionId).text());
            $('#detailsFloatingPanel h3.title').html($('#sessionTitle_' + sessionId).text());
            $('#detailsFloatingPanel .details').html($('#sessionDetails_' + sessionId).html());
            $('#detailsFloatingPanel .presenterName').text($('#presenterName_' + sessionId).text());
            $('#detailsFloatingPanel .speakerAvatar').html($('#speakerAvatar_' + sessionId).html());
            console.log($('#speakerAvatar_' + sessionId))
            // Stop event bubbling so body listener for hiding floating
            // panel won't be triggered
            e.stopPropagation();
        });
        // Prevents closing of the details panel when clicked
        $('#detailsFloatingPanel').click(function (e) {
            e.stopPropagation();
        });
        // Close button for details floating panel
        $('.closePanelButton').click(function (e) {
            if (floatingElement) {
                hideFloatingElement(floatingElement);
            }
        });
        // End - Session details floating panel

        // Session Select
        $('.interestSelectBtn .select').click(function (e) {
            // Show drop down
            if (e.target.className == 'arrow') {
                // Add to monitor the current floating element
                if (floatingElement) {
                    hideFloatingElement(floatingElement);
                }
                monitorFloatingElement('#selectOptionsWrap');

                targetSelectBtn = e.currentTarget.parentElement;

                $('#selectOptionsWrap').appendTo(targetSelectBtn);
                $('#selectOptionsWrap').fadeIn('fast', 'linear');

                // Stop event bubbling so body listener for hiding floating
                // panel won't be triggered
                e.stopPropagation();

                $('.interestSelectBtn .option').click(function (e) {
                    interestSelectHandler(targetSelectBtn, e.currentTarget);
                });
            } else {
                // Toggle through the options
            }
        });

        function interestSelectHandler(select, option) {

            var label = option.textContent,
                selectEl = $('#' + select.id),
                targetLabel = '#' + select.id + ' .select .label .text';

            $(targetLabel).text(label);

            $('#' + select.id).addClass(label);

            switch (label) {
                case 'Attending':
                    selectEl.removeClass('Interested');
                    break;
                case 'Interested':
                    selectEl.removeClass('Attending');
                    break;
                default:
                    selectEl.removeClass('Interested');
                    selectEl.removeClass('Attending');
            }
        }

        // End - Session Select

        // Sponsor floating panel
        $('.sponsorsListWrap .sponsor').hover(function (e) {
            if (timeoutVal) {
                clearTimeout(timeoutVal);
            }
            switch (e.type) {
                case 'mouseenter':
                    // Add to monitor the current floating element
                    if (floatingElement) {
                        hideFloatingElement(floatingElement);
                    }
                    monitorFloatingElement('.sponsorPanel');

                    $('.sponsorPanel').fadeIn('fast', 'linear').css({ 'top': e.pageY - 322, 'left': e.pageX - 520 });

                    break;
                case 'mouseleave':

                    monitorFloatingElement('.sponsorPanel');

                    timeoutVal = setTimeout(function () {
                        hideFloatingElement(floatingElement);
                        timeoutVal = null;
                    }, 2000);

                    break;
            }

        });

        $('.sponsorPanel').hover(function () {
            if (timeoutVal) {
                clearTimeout(timeoutVal);
            }
        }, function () {
            timeoutVal = setTimeout(function () {
                hideFloatingElement(floatingElement);
                timeoutVal = null;
            }, 1300);
        });
        // End - Speaker panel


    });
</script>


<h1 class="title">Sessions</h1>

<div class="sessionsWrap">

    <div id="selectOptionsWrap" class="selectOptionsWrap">
        <div class="option">
            <div class="icon"></div>
            <div class="label">Not Interested</div>
        </div>
        <div class="option interested">
            <div class="icon"></div>
            <div class="label">Interested</div>
        </div>
        <div class="option attending">
            <div class="icon"></div>
            <div class="label">Attending</div>
        </div>
    </div>

    <div class="floatingPanel detailsFloatingPanel" id="detailsFloatingPanel">
        <div class="closePanelButton">
            <div class="icon"></div>
        </div>
        <div class="contentWrap">
            <div class="content">
                <div class="sessionWrap">
                    <div class="textWrap">
                        <h3 class="title">3 Patterns to Scale Scrum</h3>
                        <div class="details">
                            <span class="timeIcon"></span>Saturday, 5 PM <span class="mapLocationIcon"></span>Room 302, Lot 1 &nbsp;<a href="#">Map</a>
                        </div>
                        <p class="description">Scrum is the simplest possible agile method so it's easy to get started with small team of software developers. What happens when you try to apply Scrum to large projects?</p>
                    </div>
                    <div class="footer">
                        <div class="buttonWrap">
                            <a href="#" class="button round blue">READ MORE</a>
                        </div>
                    </div>
                </div>
                <div class="speakerWrap">
                    <div class="title">Speaker</div>
                    <div class="avatarWrap">
                        <img class="speakerAvatar" src="~/Content/Images/speaker-avatar-sample.png" />
                    </div>
                    <div class="speakerInfo">
                        by <a href="#" class="presenterName">Scott Pilgrim</a><br />
                        <p>
                            Digital Project Manager<br />
                            Certified Scrum Master
                        </p>
                        <div class="buttonWrap">
                            <a href="#" class="button round blue">READ MORE</a>
                        </div>
                    </div>
                    <div class="sessionType">
                        <span class="label">Type</span>
                        <br />
                        <br />
                        Conference (<a href="#">What is it?</a>)
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pointer"></div>
        </div>
    </div>

    <div class="floatingPanel sponsorPanel">
        <div class="contentWrap">
            <div class="content">
                <div class="sponsorLogoWrap">
                    <img src="" alt="" />
                </div>
                <div class="sponsorInfoWrap">
                    <p><a href="#">Wakanda</a> is an open-source platform for developing business web and mobile applications in Javascript.</p>
                    <div class="buttonWrap">
                        <a href="#" class="button round blue">READ MORE</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="pointer"></div>
        </div>
    </div>

    <div class="sessionsList">
        <h4>Saturday, 11:15 AM</h4>
        <table>
            @{
                 var sessionCount = 0;
            }

            @foreach (var session in Model.Sessions)
            {
                sessionCount++;
    
                <tr id="session_@session.Id" class="session">
                    <td class="title" width="330">@(sessionCount)


                        @*BELOW, PresenterURL goes to link inside code camp*@

                        <span id="sessionTitle_@session.Id">@session.TitleEllipsized</span>
                        <br />
                        <i>by</i> <a href="@session.PresenterURL" class="author" id="presenterName_@session.Id">@session.SpeakersShort</a>
                        <div class="sessionDetails" id="sessionDetails_@session.Id">
                            <span class="timeIcon"></span>@session.SessionTime <span class="mapLocationIcon"></span>Room @session.RoomNumber <a href="#">Map</a>
                        </div>
                        <div class="sessionDescription" id="sessionDescription_@session.Id">@session.Description</div>
                        <div class="speakerInfox">

                            <table>
                                
                                @foreach (var speaker in session.SpeakersList)
                                {
                                    <tr>
                                        <td>
                                                  @speaker.UserLastName xxx<br/>
                                   
                                                  @* <img src="@(session.SpeakerPictureUrl)?format=gif&w=160&h=160&scale=both&mode=pad&bgcolor=white" alt="@session.PresenterName" id="speakerAvatar_@session.Id" />*@
                                                  <div class="speakerBio"></div>
                                
                                       </td>

                                    </tr>
                                }

                            </table>

                        </div>
                    </td>
                    <td class="action">
                        <div class="interestSelectBtn" id="interestSelectBtn_@session.Id">
                            <div class="select">
                                <div class="label"><span class="icon"></span><span class="text">Not Interested</span></div>
                                <div class="arrow"></div>
                            </div>
                        </div>
                    </td>
                    <td class="details">
                        <div class="detailsBtn" id="detailsBtn_@session.Id" sessionId="@session.Id">
                            <div class="icon"></div>
                            <div class="label">Details</div>
                        </div>
                    </td>
                </tr>
            }
        </table>
    </div>


</div>


@*
@foreach (var session in Model.Sessions) {
    <br/>
    @session.Title
    <br/><br/><br/>
    @session.Description
    <br/><br/><br/>
    <img src="@(session.SpeakerPictureUrl)?format=gif&w=160&h=160&scale=both&mode=pad&bgcolor=white" alt="@session.PresenterName"  />
    <br/><br/><br/>
    <a href=" @session.SessionUrl"> @session.SessionUrl</a>
    <br/> 
}
@foreach (var sponsor in Model.Sponsors) {
    <br/>
    @sponsor.SponsorName
    <br/>
    @sponsor.NavigateURL
      <br/>
    @sponsor.SponsorSupportLevel
     <br/>
    @sponsor.SponsorSupportLevelOrder
    <br/>
    @(sponsor.ImageURL)
    <br/>
    <img src="@(sponsor.ImageURL)?format=gif&w=160&h=160&scale=both&mode=pad&bgcolor=white" alt="@sponsor.SponsorName"  />
    <hr/>
}


*@





@* <script type="text/javascript">

//        $(document).ready(function () {
//            // Send an AJAX request
//            $.getJSON("api/session/GetAll",
//            function (data) {
//                // On success, 'data' contains a list of products.
//                $.each(data, function (key, val) {
//
//                    //debugger;
//
//                    // Format the text to display.
//                    //var str = val.Name + ': $' + val.Price;
//                    var str = val.PresenterName + ' : ' + val.Title;
//
//                    // Add a list item for the product.
//                    $('<li/>', { text: str })
//                    .appendTo($('#sessions'));
//                });
//            });
//        });
      


    </script>


 <div id="sessions"></div>*@